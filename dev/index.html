<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · UnitfulTensors.jl</title><meta name="title" content="Home · UnitfulTensors.jl"/><meta property="og:title" content="Home · UnitfulTensors.jl"/><meta property="twitter:title" content="Home · UnitfulTensors.jl"/><meta name="description" content="Documentation for UnitfulTensors.jl."/><meta property="og:description" content="Documentation for UnitfulTensors.jl."/><meta property="twitter:description" content="Documentation for UnitfulTensors.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>UnitfulTensors.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Features"><span>Features</span></a></li><li><a class="tocitem" href="#Basic-usage"><span>Basic usage</span></a></li><li><a class="tocitem" href="#Showcase"><span>Showcase</span></a></li><li><a class="tocitem" href="#Performance"><span>Performance</span></a></li><li><a class="tocitem" href="#Brief-API-overview"><span>Brief API overview</span></a></li><li><a class="tocitem" href="#Related-work"><span>Related work</span></a></li></ul></li><li><a class="tocitem" href="guide/">Guide</a></li><li><a class="tocitem" href="api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="UnitfulTensors.jl"><a class="docs-heading-anchor" href="#UnitfulTensors.jl">UnitfulTensors.jl</a><a id="UnitfulTensors.jl-1"></a><a class="docs-heading-anchor-permalink" href="#UnitfulTensors.jl" title="Permalink"></a></h1><p><em>A package for working efficiently with arrays of physical quantities.</em></p><p>Currently it is experimental and mostly focused on linear algebra.</p><h2 id="Features"><a class="docs-heading-anchor" href="#Features">Features</a><a id="Features-1"></a><a class="docs-heading-anchor-permalink" href="#Features" title="Permalink"></a></h2><ul><li>Support for arrays with mixed units</li><li>Indexing and assignment: scalar indices, multidimensional indices, logical indexing, omitted/trailing singleton dimensions</li><li>Arithmetic: +, -, *, \, /, ^, sqrt, dot, cross, kron, inv, pinv, lmul!, rmul!, ldiv!, rdiv!</li><li>Transcendental functions of matrices</li><li>adjoint, transpose</li><li>det, logdet, logabsdet, tr</li><li>Factorizations: lu, bunchkaufman, cholesky, ldlt, eigen, hessenberg, schur, svd, lq, qr</li><li>Norm and related functions: cond, condskeel, norm, normalize, nullspace, opnorm, rank</li><li>Rotations and reflections: rotate!, reflect!, givens</li><li>Solving Lyapunov and Sylvester equations</li><li>Support for sparse matrices</li><li>Moderate runtime overhead, often negligible</li><li>Zero-overhead mode with <a href="api/#UnitfulTensors.units_off"><code>units_off</code></a>: check the units on a small-scale problem &gt; turn them off &gt; proceed with a large-scale problem</li></ul><p>Not implemented yet:</p><ul><li>General array manipulation: hcat, vcat, repeat, reshape, permutedims, sort, etc.</li><li>Elementwise operations</li></ul><p>Future plans:</p><ul><li>Add support for frames of reference</li><li>Further optimizations: NoAxisDimensions, InverseAxisDimensions, memoization</li><li>Replace <code>FastQuantities</code> with <a href="https://github.com/SymbolicML/DynamicQuantities.jl">DynamicQuantities.jl</a></li><li><a href="https://github.com/mcabbott/Tullio.jl">Tullio.jl</a>/<a href="https://github.com/mcabbott/TensorCast.jl">TensorCast.jl</a> integration</li></ul><h2 id="Basic-usage"><a class="docs-heading-anchor" href="#Basic-usage">Basic usage</a><a id="Basic-usage-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-usage" title="Permalink"></a></h2><ul><li>Add <code>using UnitfulTensors</code> at the top of your script</li><li>Add units to your inputs and constants: <code>ħ = 1.054571817e-34 * u&quot;J*s&quot;</code></li><li>Create <a href="api/#UnitfulTensors.UnitfulTensor"><code>UnitfulTensor</code></a>s instead of arrays: <code>UnitfulTensor([1u&quot;s&quot; 2u&quot;m&quot;; 3u&quot;m&quot; 4u&quot;m^2/s&quot;])</code></li><li>Now linear algebra functions should just work</li></ul><p>See <a href="guide/#Guide">Guide</a> for more details.</p><h2 id="Showcase"><a class="docs-heading-anchor" href="#Showcase">Showcase</a><a id="Showcase-1"></a><a class="docs-heading-anchor-permalink" href="#Showcase" title="Permalink"></a></h2><pre><code class="language-julia hljs">using UnitfulTensors, LinearAlgebra

# h-parameters
H = UnitfulTensor([3.7u&quot;kΩ&quot; 1.3e-4
                   120      8.7u&quot;μS&quot;])
Zₛ = 50u&quot;Ω&quot; # Source impedance
Yₗ = 20u&quot;mS&quot; # Load admittance
Hₛ = deepcopy(H)
Hₛ[1, 1] += Zₛ
Zout = inv(Hₛ)[2, 2] # Output impedance
Hₛₗ = H + Diagonal(UnitfulTensor([Zₛ, Yₗ]))
Gₜ = 4 * Zₛ * Yₗ * (Hₛₗ[2, 1] / det(Hₛₗ))^2 # Transducer power gain
Gₜ₂ = 4 * Zₛ * Yₗ * (inv(Hₛₗ)[2, 1])^2 # Equivalent expression
println((Zout, value(Zout), Zout/1u&quot;kΩ&quot;))
println((Gₜ, Gₜ₂))

# output

(220264.31718061675 kg m^2 A^-2 s^-3, 220264.31718061675, 220.26431718061676)
(10.2353526224919, 10.2353526224919)</code></pre><h2 id="Performance"><a class="docs-heading-anchor" href="#Performance">Performance</a><a id="Performance-1"></a><a class="docs-heading-anchor-permalink" href="#Performance" title="Permalink"></a></h2><h3 id="Dense-33-matrix"><a class="docs-heading-anchor" href="#Dense-33-matrix">Dense 3×3 matrix</a><a id="Dense-33-matrix-1"></a><a class="docs-heading-anchor-permalink" href="#Dense-33-matrix" title="Permalink"></a></h3><pre><code class="language-julia hljs">using UnitfulTensors, BenchmarkTools
        
N = 3

A = randn(N, N)
b = randn(N)

uA = UnitfulTensor(A, 𝐋 * nodims(N, N))
ub = UnitfulTensor(b, 𝐌 * nodims(N))

println(&quot;Matrix * vector:&quot;)
@btime $A * $b
@btime $uA * $ub
println(&quot;Matrix * matrix:&quot;)
@btime $A * $A
@btime $uA * $uA
println(&quot;Solving a linear system:&quot;)
@btime $A \ $b
@btime $uA \ $ub

# output

Matrix * vector:
  119.563 ns (1 allocation: 80 bytes)
  160.231 ns (1 allocation: 80 bytes)
Matrix * matrix:
  82.297 ns (1 allocation: 128 bytes)
  115.884 ns (1 allocation: 128 bytes)
Solving a linear system:
  671.548 ns (3 allocations: 288 bytes)
  861.569 ns (5 allocations: 576 bytes)</code></pre><h3 id="Laplacian-on-a-1010-grid,-dense-and-sparse"><a class="docs-heading-anchor" href="#Laplacian-on-a-1010-grid,-dense-and-sparse">Laplacian on a 10×10 grid, dense and sparse</a><a id="Laplacian-on-a-1010-grid,-dense-and-sparse-1"></a><a class="docs-heading-anchor-permalink" href="#Laplacian-on-a-1010-grid,-dense-and-sparse" title="Permalink"></a></h3><pre><code class="language-julia hljs">using UnitfulTensors, LinearAlgebra, SparseArrays, BenchmarkTools

Nx = 10
N = Nx^2

Δ1d = Tridiagonal(fill(1., Nx - 1), fill(-2., Nx), fill(1., Nx - 1))
𝟙 = I(Nx)

Δ = kron(Δ1d, 𝟙) + kron(𝟙, Δ1d)
Δs = sparse(Δ)
ρ = randn(N)

uΔ = UnitfulTensor(Δ, 𝐋^-2 * nodims(N, N))
uΔs = UnitfulTensor(Δs, 𝐋^-2 * nodims(N, N))
uρ = UnitfulTensor(ρ * u&quot;C/m^3&quot;)

println(&quot;Matrix * vector:&quot;)
@btime $Δ * $ρ
@btime $uΔ * $uρ
@btime $Δs * $ρ
@btime $uΔs * $uρ
println(&quot;Matrix * matrix:&quot;)
@btime $Δ * $Δ
@btime $uΔ * $uΔ
@btime $Δs * $Δs
@btime $uΔs * $uΔs
println(&quot;Solving a linear system:&quot;)
@btime $Δ \ $ρ
@btime $uΔ \ $uρ
@btime $Δs \ $ρ
@btime $uΔs \ $uρ

# output

Matrix * vector:
  1.618 μs (1 allocation: 896 bytes)
  2.038 μs (1 allocation: 896 bytes)
  755.763 ns (1 allocation: 896 bytes)
  1.128 μs (1 allocation: 896 bytes)
Matrix * matrix:
  56.211 μs (2 allocations: 78.17 KiB)
  57.104 μs (2 allocations: 78.17 KiB)
  16.128 μs (6 allocations: 35.50 KiB)
  16.492 μs (6 allocations: 35.50 KiB)
Solving a linear system:
  150.873 μs (4 allocations: 79.92 KiB)
  153.623 μs (6 allocations: 85.67 KiB)
  455.481 μs (125 allocations: 253.85 KiB)
  455.188 μs (127 allocations: 259.60 KiB)</code></pre><p>Naively one could expect a 8x slowdown because 8 numbers are required to describe a single unitful scalar (1 for the numerical value, 7 for dimensions). This is not the case because</p><ul><li>The dimensions of a <a href="api/#UnitfulTensors.UnitfulTensor"><code>UnitfulTensor</code></a> are of tensor product form, so only about 7*(M + N) numbers are required to describe the dimensions of an M×N matrix.</li><li>Operations on dimensions are usually simpler then on numerical values. Multiplication of two N×N dense matrices requires O(N^3) operations on values and O(N) operations on dimensions.</li><li>Most linear algebra functions reuse the dimensions of their arguments. For example, matrix multiplication copies row dimensions from the first argument and column dimensions from the last argument. In such cases, only the references to the corresponding <a href="api/#UnitfulTensors.AxisDimensions"><code>AxisDimensions</code></a> are copied from one <a href="api/#UnitfulTensors.UnitfulTensor"><code>UnitfulTensor</code></a> to another, not the <a href="api/#UnitfulTensors.AxisDimensions"><code>AxisDimensions</code></a> themselves.</li><li>Other operations invert <a href="api/#UnitfulTensors.AxisDimensions"><code>AxisDimensions</code></a> (<code>inv</code>, <code>\</code>) or introduce a dimensionally homogeneous axis (<code>eigvecs</code>), so they can be sped up by implementing NoAxisDimensions and InverseAxesDimensions (not implemented yet).</li><li>Exponents of SI base units are usually rational numbers with small numerators and denominators, mostly integers and occasional half-integers. UnitfulTensors.jl stores them as <code>Float32</code> instead of <code>Float64</code>, and even smaller options can be considered.</li><li>Physical dimensions are usually far less diverse than numerical values, so memoization may be beneficial (not implemented yet).</li></ul><p>The most popular Julia package for working with unitful quantities is <a href="https://painterqubits.github.io/Unitful.jl">Unitful.jl</a>. It stores units in type parameters in an attempt to move unit computation to the compilation stage. This doesn&#39;t work well in the case of dimensionally heterogeneous arrays.</p><p>UnitfulTensors.jl has a FastQuantities submodule, which defines a type <a href="api/#UnitfulTensors.FastQuantities.SIDimensions"><code>SIDimensions</code></a>, which stores the physical dimensions of a <a href="api/#UnitfulTensors.FastQuantities.UnitfulScalar"><code>UnitfulScalar</code></a> as 7 <code>Float32</code> numbers. The speedup is noticeable:</p><pre><code class="language-julia hljs">using UnitfulTensors, BenchmarkTools
using Unitful: @u_str as @uf_str

N = 1000

u = [1. * u&quot;s&quot;^i for i in 1:N]
v = [1. * uf&quot;s&quot;^i for i in 1:N] 

println(&quot;FastQuantities&quot;)
@btime $u .* $u
println(&quot;Unitful.jl&quot;)
@btime $v .* $v

# output

FastQuantities
  4.073 μs (2 allocations: 39.11 KiB)
Unitful.jl
  1.735 ms (1024 allocations: 32.44 KiB)</code></pre><h2 id="Brief-API-overview"><a class="docs-heading-anchor" href="#Brief-API-overview">Brief API overview</a><a id="Brief-API-overview-1"></a><a class="docs-heading-anchor-permalink" href="#Brief-API-overview" title="Permalink"></a></h2><div class="mermaid">flowchart TD
    U(&quot;U::UnitfulTensor&quot;)
    V(&quot;V::AbstractArray&quot;)
    D(&quot;D::AxesDimensions&quot;)
    S(&quot;S::SIDimensions&quot;)
    T(&quot;T::NTuple{AxisDimensions}&quot;)
    A1(&quot;A1::AxisDimensions&quot;)
    A2(&quot;A2::AxisDimensions&quot;)
    V1(&quot;V1::Vector{SIDimensions}&quot;)
    V2(&quot;V2::Vector{SIDimensions}&quot;)  
    US(&quot;U[i, j]::UnitfulScalar&quot;)
    VS(&quot;V[i, j]::Number&quot;)
    DS(&quot;D[i, j]::SIDimensions\n == S*A1[i]*A2[j]\n == S*V1[i]*V2[j]&quot;)
    U --&quot;values&quot;--&gt; V
    U --&quot;dimensions&quot;--&gt; D
    D --&quot;dimscale&quot;--&gt; S
    D --&quot;normdims&quot;--&gt; T
    T --&gt; A1 &amp; A2
    A1 --&quot;dimsvec&quot;--&gt; V1
    A2 --&quot;dimsvec&quot;--&gt; V2
    U -.&quot;getindex&quot;.-&gt; US
    US --&quot;value&quot;--&gt; VS
    US --&quot;dimensions&quot;--&gt; DS</div><p><a href="api/#UnitfulTensors.UnitfulTensor"><code>UnitfulTensor</code></a> represents an array of unitful quantities that can be used in linear or multilinear algebra. It stores an <code>AbstractArray</code> of numerical values and <a href="api/#UnitfulTensors.AxesDimensions"><code>AxesDimensions</code></a> that represent its physical dimensions.</p><p>For the numerical values, you can use basic <code>Array</code>, sparse matrices, <code>StaticArrays</code>, etc., but not <code>OffsetArrays</code> or anything else with non-standard indexing.</p><p>The physical dimensions must be of tensor product form, otherwise such an array couldn&#39;t be multiplied by any vector. For example, the dimensions of a <a href="api/#UnitfulTensors.UnitfulMatrix"><code>UnitfulMatrix</code></a> are the product of its row and column dimensions.</p><p>To ensure that this decomposition is unique, the row and column dimensions are normalized (divided by scalar factors so that the first row and column dimensions are <a href="api/#UnitfulTensors.FastQuantities.NoDims"><code>NoDims</code></a>). The combined normalization factor is stored as a separate field that can be accessed via <a href="api/#UnitfulTensors.dimscale"><code>dimscale</code></a>, while the dimensions along each axis are stored as <a href="api/#UnitfulTensors.AxisDimensions"><code>AxisDimensions</code></a> objects and can be accessed via <a href="api/#UnitfulTensors.normdims"><code>normdims</code></a>.</p><h2 id="Related-work"><a class="docs-heading-anchor" href="#Related-work">Related work</a><a id="Related-work-1"></a><a class="docs-heading-anchor-permalink" href="#Related-work" title="Permalink"></a></h2><ul><li>In Julia: <a href="https://github.com/goretkin/UnitfulLinearAlgebra.jl">Goretkin</a>, <a href="https://github.com/ggebbie/UnitfulLinearAlgebra.jl">Gebbie</a>, <a href="https://github.com/ggebbie/UnitfulLinearAlgebra.jl/issues/6">more</a></li><li>In C++: <a href="https://www.youtube.com/watch?v=J6H9CwzynoQ">Withopf</a>, <a href="https://www.youtube.com/watch?v=4LmMwhM8ODI">Withopf</a>, <a href="https://www.youtube.com/watch?v=Gd5Gzl8V44o">Withopf</a>, <a href="https://www.youtube.com/watch?v=SLSTS-EvOx4">Withopf</a>, <a href="https://www.youtube.com/watch?v=QxECoAxqsvs">Withopf on Sea</a>, <a href="https://www.youtube.com/watch?v=aF3samjRzD4">Withopf</a>, <a href="https://meetingcpp.com/mcpp/slides/2021/Physical-units-for-matrices6397.pdf">Withopf</a></li><li>In the 90s: <a href="https://www.georgehart.com/research/multanal.html">Hart</a></li></ul><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="guide/">Guide »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Wednesday 8 May 2024 10:19">Wednesday 8 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
